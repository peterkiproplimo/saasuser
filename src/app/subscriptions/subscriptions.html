<!-- Full-screen wrapper -->
<div
  class="w-full h-screen bg-white dark:bg-gray-900 text-gray-800 dark:text-white flex flex-col"
>
  <div class="flex-1 overflow-y-auto px-4 py-4 sm:px-6 lg:px-8">
    <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
      <div class="w-full">
        <input
          id="search"
          [(ngModel)]="search_text"
          (input)="onSearch()"
          placeholder="Type to search..."
          class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 dark:bg-gray-800 dark:text-gray-100 transition duration-150"
        />
      </div>
    </div>
    <div class="p-4 overflow-auto">
      <div class="flow-root">
        <div class="m-0">
          <div class="inline-block min-w-full py-2 align-middle">
            <div
              class="overflow-hidden shadow-sm ring-1 ring-black/5 sm:rounded-lg"
            >
              <table
                class="min-w-full divide-y divide-gray-300 dark:divide-gray-700"
              >
                <thead class="bg-gray-50 dark:bg-gray-800">
                  <tr>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Subscription #
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Party
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Plan
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Quantity
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Cost
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Currency
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Invoice Date
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Invoice Due Date
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Latest Invoice
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Status
                    </th>
                    <th
                      class="py-3 px-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100"
                    >
                      Due
                    </th>
                  </tr>
                </thead>

                <tbody
                  class="divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-900"
                >
                  <tr *ngFor="let sub of list()?.data">
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.name }}
                    </td>
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.party }}
                    </td>
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.plans[0]?.plan }}
                    </td>
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.plans[0]?.qty }}
                    </td>

                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.plans[0]?.cost | number:'1.2-2' }}
                    </td>
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.plans[0]?.currency }}
                    </td>
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.current_invoice_start | date:'yyyy-MM-dd HH:mm' }}
                    </td>
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      {{ sub.current_invoice_end | date:'yyyy-MM-dd HH:mm' }}
                    </td>

                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      <div>{{ sub.latest_invoice?.name }}</div>
                    </td>
                    <td
                      class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100"
                    >
                      <div class="text-xs text-gray-500 dark:text-gray-400">
                        {{ sub.latest_invoice.status }},
                      </div>
                    </td>
                    <td class="px-4 py-3">
                      <span
                        class="inline-block px-2 py-1 text-xs font-semibold rounded-full capitalize"
                        [ngClass]="{
                          'bg-green-100 text-green-800': sub.status === 'active',
                          'bg-yellow-100 text-yellow-800': sub.status === 'pending',
                          'bg-red-100 text-red-800': sub.status === 'cancelled'
                        }"
                      >
                        {{ sub.status }}
                      </span>
                    </td>
                  </tr>
                </tbody>

                <ng-template #noData>
                  <tbody>
                    <tr>
                      <td colspan="8" class="py-4">
                        <div class="w-full flex flex-col items-center">
                          <h3
                            class="text-lg font-medium text-gray-700 dark:text-gray-300"
                          >
                            No Subscriptions Found
                          </h3>
                          <p class="text-gray-500 dark:text-gray-400 mt-2">
                            Try adjusting your filters or check back later.
                          </p>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </ng-template>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <p-paginator
      (onPageChange)="onPageChange($event)"
      [first]="page * pageSize"
      [rows]="pageSize"
      [totalRecords]="totalRecords()"
      [showCurrentPageReport]="true"
      [showPageLinks]="true"
      [rowsPerPageOptions]="[5, 10, 20]"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} subscriptions"
    ></p-paginator>

    <!-- Loading & Error States -->
    <div *ngIf="loading" class="px-4 py-2 text-center text-sm">
      Loading subscriptionsâ€¦
    </div>
    <div *ngIf="error" class="px-4 py-2 text-center text-sm text-red-600">
      {{ error }}
    </div>
  </div>

  <!-- Dialog -->
  <p-dialog
    header="New Subscription"
    [(visible)]="showDialog"
    [modal]="true"
    [style]="{ width: '30rem' }"
    [contentStyle]="{ padding: '1.5rem 2rem' }"
  >
    <!-- Form Body -->
    <div class="p-fluid space-y-4">
      <div class="field">
        <label for="plan" class="block text-sm font-medium text-gray-700"
          >Plan</label
        >
        <input id="plan" pInputText [(ngModel)]="form.plan" />
      </div>
      <div class="field">
        <label for="qty" class="block text-sm font-medium text-gray-700"
          >Quantity</label
        >
        <input id="qty" type="number" pInputText [(ngModel)]="form.qty" />
      </div>
    </div>

    <!-- Footer -->
    <ng-template pTemplate="footer">
      <div class="flex justify-center gap-4 py-2">
        <button
          pButton
          label="Cancel"
          class="p-button-text"
          (click)="showDialog = false"
        ></button>
        <button
          pButton
          label="Create"
          class="p-button-primary"
          (click)="createSubscription()"
        ></button>
      </div>
    </ng-template>
  </p-dialog>
</div>
