<div class="p-4 overflow-auto">
  <div class="flow-root">
    <div class="m-0">
      <div>
        <h2
          class="text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-4"
        >
          Billing History
        </h2>

        <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
          <div class="w-full">
            <label for="">Search Term</label>
            <input
              [(ngModel)]="search_text"
              placeholder="Search"
              class="w-full p-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
            />
          </div>

          <div class="w-full">
            <label for="">Start Date</label>
            <p-calendar
              appendTo="body"
              [(ngModel)]="start_date"
              [showIcon]="true"
              [showButtonBar]="true"
              [placeholder]="'Start Date'"
              [dateFormat]="'mm/dd/yy'"
              [maxDate]="end_date()"
              styleClass="w-full"
            />
          </div>

          <div class="w-full">
            <label for="">End Date</label>
            <p-calendar
              appendTo="body"
              [(ngModel)]="end_date"
              [showIcon]="true"
              [showButtonBar]="true"
              [placeholder]="'End Date'"
              [dateFormat]="'mm/dd/yy'"
              [minDate]="start_date()"
              styleClass="w-full"
            />
          </div>
          <div class="w-full">
            <label for="">Reference No</label>
            <input
              [(ngModel)]="referenceNo"
              placeholder="Enter Reference No"
              class="w-full p-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
            />
          </div>
          <!-- Credit Amount -->
          <div class="w-full">
            <label for="">Credit Amount</label>
            <input
              type="number"
              [(ngModel)]="creditAmount"
              placeholder="Min Credit Amount"
              class="w-full p-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400"
            />
          </div>
        </div>
      </div>

      <div class="inline-block min-w-full py-2 align-middle">
        <div class="overflow-auto shadow-sm ring-1 ring-black/5 sm:rounded-lg">
          <table
            class="min-w-full divide-y divide-gray-300 dark:divide-gray-700 overflow-x-auto"
          >
            <thead class="bg-gray-50 dark:bg-gray-800 w-full">
              <tr class="w-full">
                <th
                  scope="col"
                  class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  Posting Date
                </th>
                <th
                  scope="col"
                  class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  Reference
                </th>
                <th
                  scope="col"
                  class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  Reference No
                </th>
                <th
                  scope="col"
                  class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  Debit
                </th>
                <th
                  scope="col"
                  class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  Credit
                </th>
                <th
                  scope="col"
                  class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  Balance
                </th>

                <th
                  scope="col"
                  class="py-3.5 pr-3 pl-4 text-left text-sm font-semibold text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  Remarks
                </th>
              </tr>
            </thead>
            <tbody
              class="divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-900"
            >
              <!-- Loading State -->
              @if (is_loading()) {
              <tr class="w-full">
                <td colspan="9" class="text-center py-4">
                  <div class="w-full flex justify-center">
                    <p-progressSpinner
                      class="text-gray-500 dark:text-gray-400"
                      [style]="{ width: '40px', height: '40px' }"
                    >
                    </p-progressSpinner>
                  </div>
                </td>
              </tr>
              } @else { @if (ledger().data?.length! > 0) { @for (ledger_entry of
              ledger().data; track ledger_entry.name) {

              <tr class="w-full">
                <td
                  class="py-3 pr-3 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  {{ ledger_entry.posting_date | date: 'yyyy-MM-dd' }}
                </td>
                <td
                  class="py-3 pr-3 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  {{ ledger_entry.voucher_type }}
                </td>
                <td
                  class="py-3 pr-3 pl-4 text-sm font-medium whitespace-nowrap text-blue-600 dark:text-blue-400 cursor-pointer underline sm:pl-6"
                  (click)="openVoucherDialog(ledger_entry)"
                >
                  {{ ledger_entry.voucher_no }}
                </td>

                <td
                  class="py-3 pr-3 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  {{ ledger_entry.debit | number: '1.2-2' }}
                </td>
                <td
                  class="py-3 pr-3 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  {{ ledger_entry.credit | number: '1.2-2' }}
                </td>
                <td
                  class="py-3 pr-3 pl-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  {{ ledger_entry.balance | number: '1.2-2' }}
                </td>

                <td
                  class="py-3 pr-3 pl-4 text-sm font-medium whitespace-nowrap max-w-[10rem] truncate text-gray-900 dark:text-gray-100 sm:pl-6"
                >
                  {{ ledger_entry.remarks }}
                </td>
              </tr>

              } } @else {
              <tr class="w-full">
                <td colspan="9" class="py-4">
                  <div class="w-full flex justify-center">
                    <app-empty-state class="text-center">
                      <h3
                        class="text-lg font-medium text-gray-700 dark:text-gray-300"
                        slot="title"
                      >
                        No Billing History Found
                      </h3>
                      <p
                        class="text-gray-500 dark:text-gray-400 mt-2"
                        slot="message"
                      >
                        Try adjusting your search term or check back later for
                        more.
                      </p>
                    </app-empty-state>
                  </div>
                </td>
              </tr>
              } }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="flex justify-center w-full">
  <p-paginator
    (onPageChange)="onPageChange($event)"
    [first]="first()"
    [rows]="pageSize()"
    [totalRecords]="totalRecords()"
    [showCurrentPageReport]="true"
    [showPageLinks]="false"
    [showJumpToPageDropdown]="false"
    [rowsPerPageOptions]="[5, 10, 20, 30]"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords}"
  />
</div>
<p-dialog
  header="Voucher Details"
  [(visible)]="voucherDialogVisible"
  [modal]="true"
  [style]="{ width: '600px' }"
  (onHide)="closeVoucherDialog()"
>
  <div *ngIf="selectedVoucher">
    <p><strong>Reference:</strong> {{ selectedVoucher.voucher_type }}</p>
    <p><strong>Reference No:</strong> {{ selectedVoucher.voucher_no }}</p>
    <p>
      <strong>Posting Date:</strong>
      {{ selectedVoucher.posting_date | date: 'yyyy-MM-dd' }}
    </p>
    <p><strong>Debit:</strong> {{ selectedVoucher.debit | number: '1.2-2' }}</p>
    <p>
      <strong>Credit:</strong> {{ selectedVoucher.credit | number: '1.2-2' }}
    </p>
    <p>
      <strong>Balance:</strong> {{ selectedVoucher.balance | number: '1.2-2' }}
    </p>
    <p><strong>Remarks:</strong> {{ selectedVoucher.remarks }}</p>
  </div>
</p-dialog>
